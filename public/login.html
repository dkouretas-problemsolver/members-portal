<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ProblemSolver • Σύνδεση</title>
  <link rel="icon" href="/favicon.ico" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--orange:#FF6B00;--ink:#111;--muted:#6b7280;--bg:#f6f7f9;--card:#fff;--line:#e5e7eb}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);font-family:Inter,system-ui}
    .wrap{min-height:100vh;display:grid;place-items:center;padding:24px}
    .card{width:min(440px,95vw);background:var(--card);border-radius:18px;padding:28px;box-shadow:0 16px 40px rgba(17,24,39,.08)}
    h1{margin:0 0 6px;font-size:22px}
    p{margin:0 0 18px;color:var(--muted)}
    label{font-weight:600;font-size:14px;display:block;margin-bottom:6px}
    input{width:100%;padding:12px 14px;border:1px solid var(--line);border-radius:12px;font-size:15px;outline:none}
    input:focus{border-color:var(--orange)}
    .row{display:flex;gap:10px;align-items:center;margin-top:14px}
    .btn{cursor:pointer;border:0;border-radius:12px;padding:12px 16px;font-weight:700}
    .btn-primary{background:var(--orange);color:#fff;width:100%}
    .muted{color:var(--muted);font-size:13px;margin-top:12px}
    .alert{margin-top:14px;padding:12px;border-radius:12px}
    .alert-ok{background:#ecfdf5;color:#065f46;border:1px solid #a7f3d0}
    .alert-bad{background:#fef2f2;color:#991b1b;border:1px solid #fecaca}
    .link{color:var(--orange);text-decoration:none}
    .toplink{position:absolute;left:16px;top:16px}
  </style>
  <script src="https://unpkg.com/@supabase/supabase-js@2.45.4/dist/umd/supabase.js"></script>
</head>
<body>
  <a class="toplink link" href="/dashboard.html">← Πίσω στο Dashboard</a>
  <div class="wrap">
    <div class="card">
      <h1>Σύνδεση</h1>
      <p>Βάλε το email σου· θα σου στείλουμε magic-link για άμεση είσοδο.</p>

      <label for="email">Email</label>
      <input id="email" type="email" placeholder="you@example.com" autocomplete="email" />

      <div class="row">
        <button id="sendBtn" class="btn btn-primary">Στείλε magic-link</button>
      </div>

      <div id="msgOk" class="alert alert-ok" style="display:none">Σου στείλαμε email. Έλεγξε τα εισερχόμενα.</div>
      <div id="msgBad" class="alert alert-bad" style="display:none">Κάτι πήγε στραβά. Δοκίμασε ξανά.</div>

      <div class="muted">
        Ήδη συνδεδεμένος; <a class="link" href="/dashboard.html">Πήγαινε στο Dashboard</a>
      </div>
    </div>
  </div>

<script>
const SUPA_URL  = 'https://sctqieecpfsaszcuqcrv.supabase.co';      // π.χ. https://xxxx.supabase.co
const SUPA_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjdHFpZWVjcGZzYXN6Y3VxY3J2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkxODI5MjYsImV4cCI6MjA3NDc1ODkyNn0.swR5_WutqIlCvpH4s-2LEYgrH-UAp0op2sfKQeVWQOk'; // anon key

const supabase = window.supabase.createClient(SUPA_URL, SUPA_ANON, {
  db: { schema: 'app' },
  auth: { persistSession: true, autoRefreshToken: true, detectSessionInUrl: true }
});

// Αν έχουμε ήδη session, φύγαμε για dashboard
(async () => {
  const { data: { session } } = await supabase.auth.getSession();
  if (session) window.location.href = '/dashboard.html';
})();

const emailEl = document.getElementById('email');
const okEl = document.getElementById('msgOk');
const badEl = document.getElementById('msgBad');

function show(el){ el.style.display='block'; }
function hide(el){ el.style.display='none'; }

document.getElementById('sendBtn').addEventListener('click', async () => {
  hide(okEl); hide(badEl);
  const email = (emailEl.value || '').trim();
  if (!email) { show(badEl); badEl.textContent = 'Γράψε το email σου.'; return; }

  // στείλε magic-link (email OTP)
  const { error } = await supabase.auth.signInWithOtp({
    email,
    options: {
      // μετά το click στο email, θα πατήσει εδώ:
      emailRedirectTo: `${window.location.origin}/dashboard.html`
    }
  });

  if (error) { show(badEl); badEl.textContent = 'Σφάλμα: ' + (error.message || 'Άγνωστο.'); return; }
  show(okEl); okEl.textContent = 'Σου στείλαμε email. Άνοιξέ το από αυτή τη συσκευή.';
});
</script>
</body>
</html>
