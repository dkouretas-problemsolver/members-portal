<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Members – ProblemSolver</title>
  <style>
    :root{
      --brand:#FF6B00;
      --text:#222;
      --muted:#666;
      --line:#e9e9e9;
      --bg:#fafafa;
      --radius:16px;
    }
    html,body{height:100%}
    body{
      margin:0; padding:24px; background:var(--bg);
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; color:var(--text);
    }
    .wrap{ max-width: 760px; margin:0 auto; display:grid; gap:18px; }
    .card{
      background:#fff; border:1px solid var(--line); border-radius:var(--radius);
      box-shadow:0 6px 24px rgba(0,0,0,.06); padding:22px;
    }
    .grid{ display:grid; gap:12px }
    h1{ margin:0 0 6px; font-size:22px }
    p.lead{ margin:0 0 6px; color:var(--muted); font-size:14px }
    label{ font-size:13px; color:#444 }
    input[type="email"],input[type="password"]{
      width:100%; padding:12px 14px; border:1px solid #ddd; border-radius:12px; font-size:16px;
      outline:none;
    }
    input:focus{ border-color:#bbb }
    .row{ display:grid; grid-template-columns:1fr 1fr; gap:12px }
    .btn{
      appearance:none; border:0; border-radius:12px; padding:12px 16px; cursor:pointer;
      font-size:16px; background:var(--brand); color:#fff;
    }
    .btn.secondary{ background:#111; color:#fff }
    .btn.ghost{
      background:#fff; color:#111; border:1px solid #ddd; display:flex; align-items:center; gap:10px; justify-content:center;
    }
    .muted{ color:var(--muted); font-size:13px }
    .error{ color:#c00; font-size:13px; margin-top:6px }
    .divider{ height:1px; background:var(--line); margin:8px 0 }
    .topbar{ display:flex; align-items:center; justify-content:space-between; }
    .brand{ display:flex; gap:10px; align-items:center; font-weight:700 }
    .brand .dot{ width:10px; height:10px; background:var(--brand); border-radius:50% }
    .actions{ display:flex; gap:8px; }
    .link{ background:none; border:0; color:#0b66ff; padding:0; cursor:pointer; font-size:14px }
    .center{ text-align:center }
    .hidden{ display:none !important }
  </style>
</head>
<body>
  <div class="wrap">

    <div class="topbar">
      <div class="brand"><span class="dot"></span> ProblemSolver – Members</div>
      <div class="actions">
        <button id="toLogin" class="link">Σύνδεση</button>
        <button id="toSignup" class="link">Εγγραφή</button>
      </div>
    </div>

    <!-- LOGIN -->
    <section id="loginCard" class="card">
      <h1>Σύνδεση</h1>
      <p class="lead">Μπες με email/κωδικό ή με Google.</p>
      <div class="grid">
        <label for="login-email">Email</label>
        <input id="login-email" type="email" placeholder="name@domain.gr" autocomplete="username" />
        <label for="login-password">Κωδικός</label>
        <input id="login-password" type="password" placeholder="Ο κωδικός σου" autocomplete="current-password" />
        <button id="loginBtn" class="btn">Σύνδεση</button>
        <div class="row">
          <button id="googleBtn" class="btn ghost" type="button" title="Σύνδεση με Google">
            <!-- Google G SVG (inline για να φαίνεται πάντα) -->
            <svg width="18" height="18" viewBox="0 0 48 48" aria-hidden="true">
              <path fill="#FFC107" d="M43.6 20.5H42V20H24v8h11.3C33.5 32.6 29.1 36 24 36c-6.6 0-12-5.4-12-12s5.4-12 12-12c3 0 5.7 1.1 7.8 3l5.7-5.7C34.5 6.1 29.5 4 24 4 12.9 4 4 12.9 4 24s8.9 20 20 20c10.2 0 19-7.4 19-20 0-1.3-.1-2.7-.4-3.5z"/>
              <path fill="#FF3D00" d="M6.3 14.7l6.6 4.8C14.8 16.6 19 14 24 14c3 0 5.7 1.1 7.8 3l5.7-5.7C34.5 6.1 29.5 4 24 4 16 4 9.1 8.4 6.3 14.7z"/>
              <path fill="#4CAF50" d="M24 44c5 0 9.6-1.9 13-5.1l-6-4.9C29 35.3 26.7 36 24 36c-5 0-9.3-3.4-10.8-8.1l-6.7 5.1C9.2 39.6 16 44 24 44z"/>
              <path fill="#1976D2" d="M43.6 20.5H42V20H24v8h11.3c-1.3 3.7-4.8 6-11.3 6-5 0-9.3-3.4-10.8-8.1l-6.7 5.1C9.2 39.6 16 44 24 44c10.2 0 19-7.4 19-20 0-1.3-.1-2.7-.4-3.5z"/>
            </svg>
            Σύνδεση με Google
          </button>
          <button id="forgotLink" class="link" type="button">Ξέχασα τον κωδικό</button>
        </div>
        <div id="loginErr" class="error hidden"></div>
      </div>
    </section>

    <!-- SIGNUP -->
    <section id="signupCard" class="card hidden">
      <h1>Εγγραφή</h1>
      <p class="lead">Δημιούργησε λογαριασμό.</p>
      <div class="grid">
        <label for="su-email">Email</label>
        <input id="su-email" type="email" placeholder="name@domain.gr" autocomplete="email" />
        <label for="su-password">Κωδικός</label>
        <input id="su-password" type="password" placeholder="Δημιούργησε κωδικό (8+ χαρακτήρες)" autocomplete="new-password" />
        <label for="su-password2">Επανάληψη κωδικού</label>
        <input id="su-password2" type="password" placeholder="Ξαναγράψε τον κωδικό" autocomplete="new-password" />
        <button id="signupBtn" class="btn secondary">Εγγραφή</button>
        <div id="signupErr" class="error hidden"></div>
        <p class="muted">Έχεις ήδη λογαριασμό; <button class="link" id="goLogin">Σύνδεση</button></p>
      </div>
    </section>

    <!-- FORGOT -->
    <section id="forgotCard" class="card hidden">
      <h1>Ανάκτηση κωδικού</h1>
      <p class="lead">Θα σου στείλουμε email με σύνδεσμο επαναφοράς.</p>
      <div class="grid">
        <label for="fp-email">Email</label>
        <input id="fp-email" type="email" placeholder="name@domain.gr" autocomplete="email" />
        <button id="sendResetBtn" class="btn">Στείλε σύνδεσμο</button>
        <div id="forgotInfo" class="muted"></div>
        <div id="forgotErr" class="error hidden"></div>
        <div class="divider"></div>
        <p class="muted">Θυμήθηκες τον κωδικό; <button id="backToLogin" class="link">Πίσω στη σύνδεση</button></p>
      </div>
    </section>

    <p class="center muted">© ProblemSolver</p>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    // ------- Supabase -------
    const SUPABASE_URL = 'https://sctqieecpfsaszcuqcrv.supabase.co'
    const SUPABASE_ANON_KEY = 'PASTE_YOUR_ANON_KEY_HERE'
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
      auth: { autoRefreshToken:true, persistSession:true, detectSessionInUrl:true }
    })
    // expose για γρήγορο debug
    window.supabase = supabase

    // ------- UI refs -------
    const loginCard = document.getElementById('loginCard')
    const signupCard = document.getElementById('signupCard')
    const forgotCard = document.getElementById('forgotCard')
    const show = (el)=>el.classList.remove('hidden')
    const hide = (el)=>el.classList.add('hidden')

    // Nav
    document.getElementById('toLogin').onclick = ()=>{ show(loginCard); hide(signupCard); hide(forgotCard) }
    document.getElementById('toSignup').onclick = ()=>{ hide(loginCard); show(signupCard); hide(forgotCard) }
    document.getElementById('goLogin').onclick = ()=>{ show(loginCard); hide(signupCard); hide(forgotCard) }
    document.getElementById('forgotLink').onclick = ()=>{ hide(loginCard); hide(signupCard); show(forgotCard) }
    document.getElementById('backToLogin').onclick = ()=>{ show(loginCard); hide(signupCard); hide(forgotCard) }

    // ------- LOGIN -------
    const loginBtn = document.getElementById('loginBtn')
    const loginErr = document.getElementById('loginErr')
    loginBtn.addEventListener('click', async (e)=>{
      e.preventDefault()
      loginErr.classList.add('hidden'); loginErr.textContent=''
      const email = document.getElementById('login-email').value.trim()
      const password = document.getElementById('login-password').value
      if(!email || !password){ loginErr.textContent='Συμπλήρωσε email και κωδικό.'; loginErr.classList.remove('hidden'); return }
      const { error } = await supabase.auth.signInWithPassword({ email, password })
      if(error){ loginErr.textContent = 'Σφάλμα: ' + error.message; loginErr.classList.remove('hidden'); return }
      window.location.href = '/dashboard.html'
    })

    // Google OAuth (με logo που φαίνεται, χωρίς popup block)
    document.getElementById('googleBtn').addEventListener('click', async (e)=>{
      e.preventDefault()
      const { error } = await supabase.auth.signInWithOAuth({
        provider:'google',
        options: { redirectTo: 'https://members.problemsolver.gr/dashboard.html' }
      })
      if(error) alert('Google σύνδεση: ' + error.message)
    })

    // ------- SIGNUP -------
    const signupBtn = document.getElementById('signupBtn')
    const signupErr = document.getElementById('signupErr')
    signupBtn.addEventListener('click', async (e)=>{
      e.preventDefault()
      signupErr.classList.add('hidden'); signupErr.textContent=''
      const email = document.getElementById('su-email').value.trim()
      const p1 = document.getElementById('su-password').value
      const p2 = document.getElementById('su-password2').value
      if(!email || !p1 || !p2){ signupErr.textContent='Συμπλήρωσε όλα τα πεδία.'; signupErr.classList.remove('hidden'); return }
      if(p1 !== p2){ signupErr.textContent='Οι κωδικοί δεν ταιριάζουν.'; signupErr.classList.remove('hidden'); return }
      const { error } = await supabase.auth.signUp({ email, password:p1 })
      if(error){ signupErr.textContent='Σφάλμα: '+error.message; signupErr.classList.remove('hidden'); return }
      alert('Έγινε εγγραφή. Έλεγξε το email σου για επιβεβαίωση (αν απαιτείται).')
      show(loginCard); hide(signupCard); hide(forgotCard)
    })

    // ------- FORGOT / RESET EMAIL -------
    const sendResetBtn = document.getElementById('sendResetBtn')
    const forgotErr = document.getElementById('forgotErr')
    const forgotInfo = document.getElementById('forgotInfo')
    sendResetBtn.addEventListener('click', async (e)=>{
      e.preventDefault()
      forgotErr.classList.add('hidden'); forgotErr.textContent=''
      forgotInfo.textContent=''
      const email = document.getElementById('fp-email').value.trim()
      if(!email){ forgotErr.textContent='Βάλε το email σου.'; forgotErr.classList.remove('hidden'); return }
      const { error } = await supabase.auth.resetPasswordForEmail(email, {
        redirectTo: 'https://members.problemsolver.gr/reset.html'
      })
      if(error){ forgotErr.textContent='Σφάλμα: '+error.message; forgotErr.classList.remove('hidden'); return }
      forgotInfo.textContent = 'Αν υπάρχει αυτός ο λογαριασμός, στάλθηκε email με σύνδεσμο επαναφοράς.'
    })

    // Αν είμαστε ήδη logged-in, πήγαινε κατευθείαν
    const { data:{ session } } = await supabase.auth.getSession()
    if(session?.user) window.location.href='/dashboard.html'
  </script>
</body>
</html>
