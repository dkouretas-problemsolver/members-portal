<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ProblemSolver – Members</title>
  <style>
    :root { --brand:#FF6B00; }
    *{ box-sizing:border-box; }
    body { font-family: Inter, Arial, sans-serif; margin: 0; padding: 32px; background:#fafafa; }
    .card { max-width: 720px; margin: 0 auto; padding: 22px; border: 1px solid #eee; border-radius: 16px; box-shadow: 0 6px 24px rgba(0,0,0,.06); background:#fff; }
    img.logo { max-width:140px; display:block; margin:0 auto 6px; }
    h1 { margin:6px 0 10px; font-size: 22px; text-align:center; }
    #status { display:inline-block; margin: 6px auto 10px; }
    p { color: #444; }
    label { display:block; font-size:13px; margin: 8px 0 6px; }
    input[type="email"], input[type="password"]{
      width:100%; padding:12px 14px; border:1px solid #ddd; border-radius:12px; font-size:16px;
      background:#fff;
    }
    input + input{ margin-top:8px; }
    button{ margin-top:12px; padding:12px 16px; border:0; border-radius:12px; font-size:16px; cursor:pointer; }
    .primary{ background:var(--brand); color:#fff; }
    .muted{ background:#f3f4f6; }
    .chip{ padding:6px 10px; border-radius:999px; background:#f3f4f6; font-size:12px; }
    .ok{ color:#0f9d58 } .err{ color:#d93025 }
    .footer{ margin-top:10px; font-size:12px; color:#777; }
    .hr{ height:1px; background:#eee; margin:16px 0; }
    .row{ display:flex; gap:40px; align-items:flex-start; justify-content:space-between; margin-top:16px; }
    .col{ flex:1; }
    .col .box{ padding:10px 0; }
    .google-wrap { text-align:center; margin: 10px 0 6px; }
    .btn-google{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 14px; border-radius:12px; border:1px solid #ddd;
      background:#fff; color:#222; font-weight:500; cursor:pointer;
    }
    .btn-google:hover{ background:#f7f7f7; }
    .g-icon{ width:18px; height:18px; display:inline-block; }
    .link{ background:none; border:0; color:#0b66ff; padding:0; cursor:pointer; }
  </style>
</head>
<body>
  <div class="card">
    <!-- ΛΟΓΟΤΥΠΟ / ΤΙΤΛΟΣ -->
    <img src="brandmark-design-1080x1080.png" alt="ProblemSolver Logo" class="logo" />
    <h1>ProblemSolver – Members</h1>
    <p id="status" class="chip">Δεν είσαι συνδεδεμένος</p>

    <!-- Google -->
    <div class="google-wrap">
      <button id="googleBtn" class="btn-google">
        <span class="g-icon" aria-hidden="true">
          <svg viewBox="0 0 48 48">
            <path fill="#FFC107" d="M43.611 20.083h-1.611V20H24v8h11.303C33.928 31.91 29.329 35 24 35c-7.18 0-13-5.82-13-13s5.82-13 13-13c3.115 0 5.964 1.108 8.185 2.941l5.657-5.657C34.759 3.174 29.624 1 24 1 11.85 1 2 10.85 2 23s9.85 22 22 22c11.041 0 21-8 21-22 0-1.258-.135-2.477-.389-3.917z"/>
            <path fill="#FF3D00" d="M6.306 14.691l6.571 4.817C14.242 16.33 18.77 13 24 13c3.115 0 5.964 1.108 8.185 2.941l5.657-5.657C34.759 3.174 29.624 1 24 1 15.322 1 7.871 5.937 4.306 13.309l2 1.382z"/>
            <path fill="#4CAF50" d="M24 45c5.24 0 10.003-1.943 13.61-5.17l-6.278-5.318C29.211 36.488 26.77 37 24 37c-5.304 0-9.882-3.4-11.922-7.528l-6.58 5.07C8.994 40.777 15.94 45 24 45z"/>
            <path fill="#1976D2" d="M43.611 20.083H24v8h11.303A12.01 12.01 0 0 1 24 37c-5.304 0-9.882-3.07-11.922-7.528l-6.58 5.07C8.994 40.777 15.94 45 24 45c11.041 0 21-8 21-22 0-1.258-.135-2.477-.389-3.917z"/>
          </svg>
        </span>
        <span>Σύνδεση με Google</span>
      </button>
    </div>

    <div class="hr"></div>

    <!-- ΔΥΟ ΞΕΧΩΡΙΣΤΕΣ ΦΟΡΜΕΣ (όπως τις είχες) -->
    <div class="row">

      <!-- Κωδικός -->
      <div class="col">
        <div class="box">
          <h3>Σύνδεση με Κωδικό</h3>
          <label for="emailLogin">Email</label>
          <input id="emailLogin" type="email" placeholder="you@example.com" autocomplete="email" />
          <label for="passwordLogin">Κωδικός</label>
          <input id="passwordLogin" type="password" placeholder="••••••••" autocomplete="current-password" />
          <button id="loginBtn" class="primary">Σύνδεση</button>
          <button id="signupBtn" class="muted">Δημιουργία Λογαριασμού</button>
          <p class="footer">
            <!-- ΜΟΝΗ ΑΛΛΑΓΗ: από link σε κουμπί που στέλνει reset email -->
            <button id="forgotLink" class="link" type="button">Ξέχασα τον κωδικό</button>
            <span id="forgotMsg" class="footer"></span>
          </p>
        </div>
      </div>

      <!-- Magic Link -->
      <div class="col">
        <div class="box">
          <h3>Σύνδεση με Magic Link</h3>
          <label for="emailMagic">Email</label>
          <input id="emailMagic" type="email" placeholder="you@example.com" autocomplete="email" />
          <button id="sendLink" class="primary">Στείλε μου Magic Link</button>
          <p id="msg" class="footer"></p>
        </div>
      </div>

    </div>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    // ΒΑΛΕ τα δικά σου:
    const SUPABASE_URL = 'https://sctqieecpfsaszcuqcrv.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjdHFpZWVjcGZzYXN6Y3VxY3J2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkxODI5MjYsImV4cCI6MjA3NDc1ODkyNn0.swR5_WutqIlCvpH4s-2LEYgrH-UAp0op2sfKQeVWQOk';
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
      auth: { autoRefreshToken:true, persistSession:true, detectSessionInUrl:true }
    });

    const statusEl = document.getElementById('status');
    const msgEl    = document.getElementById('msg');

    async function updateStatus() {
      const { data: { session } } = await supabase.auth.getSession();
      if (session?.user) {
        statusEl.textContent = "Συνδεδεμένος: " + (session.user.email || "");
        statusEl.className = "chip ok";
        window.location.href = "/dashboard.html";
      } else {
        statusEl.textContent = "Δεν είσαι συνδεδεμένος";
        statusEl.className = "chip";
      }
    }

    // Google
    document.getElementById('googleBtn')?.addEventListener('click', async () => {
      const { error } = await supabase.auth.signInWithOAuth({
        provider: 'google',
        options: { redirectTo: window.location.origin + '/dashboard.html' }
      });
      if (error) alert(error.message);
    });

    // Magic link
    document.getElementById('sendLink')?.addEventListener('click', async () => {
      msgEl.textContent = '';
      const email = document.getElementById('emailMagic').value.trim();
      const { error } = await supabase.auth.signInWithOtp({
        email,
        options: { emailRedirectTo: window.location.origin }
      });
      if (error) { msgEl.textContent = "Σφάλμα: " + error.message; msgEl.className="footer err"; }
      else { msgEl.textContent = "Σου στείλαμε link στο email."; msgEl.className="footer ok"; }
    });

    // Email/Password login
    document.getElementById('loginBtn')?.addEventListener('click', async () => {
      const email = document.getElementById('emailLogin').value.trim();
      const pass  = document.getElementById('passwordLogin').value.trim();
      const { error } = await supabase.auth.signInWithPassword({ email, password:pass });
      if (error) alert("Σφάλμα: " + error.message);
      else updateStatus();
    });

    // Signup (όπως το είχες: χρησιμοποιεί τα ίδια πεδία)
    document.getElementById('signupBtn')?.addEventListener('click', async () => {
      const email = document.getElementById('emailLogin').value.trim();
      const pass  = document.getElementById('passwordLogin').value.trim();
      const { error } = await supabase.auth.signUp({
        email, password:pass,
        options: { emailRedirectTo: window.location.origin }
      });
      if (error) alert("Σφάλμα: " + error.message);
      else alert("Έγινε εγγραφή, έλεγξε το email σου.");
    });

    // --------------------------
    // ΜΟΝΟ αυτό προστέθηκε/διορθώθηκε
    // --------------------------
    const forgotLink = document.getElementById('forgotLink');
    const forgotMsg  = document.getElementById('forgotMsg');

    forgotLink.addEventListener('click', async (e) => {
      e.preventDefault();
      forgotMsg.textContent = '';
      // Παίρνουμε email από το πεδίο login· αν είναι κενό, δοκίμασε του Magic
      const emailLogin = document.getElementById('emailLogin').value.trim();
      const fallback   = document.getElementById('emailMagic').value.trim();
      const email = emailLogin || fallback;
      if (!email) {
        forgotMsg.textContent = 'Βάλε email στο πεδίο και ξαναπροσπάθησε.';
        forgotMsg.className = 'footer err';
        return;
      }

      const { error } = await supabase.auth.resetPasswordForEmail(email, {
        redirectTo: 'https://members.problemsolver.gr/reset.html'
      });

      if (error) {
        forgotMsg.textContent = 'Σφάλμα: ' + error.message; // π.χ. Invalid API key αν το key δεν είναι σωστό
        forgotMsg.className = 'footer err';
      } else {
        forgotMsg.textContent = 'Στάλθηκε σύνδεσμος επαναφοράς (αν υπάρχει ο λογαριασμός).';
        forgotMsg.className = 'footer ok';
      }
    });
    // --------------------------

    updateStatus();
    supabase.auth.onAuthStateChange(updateStatus);
  </script>
</body>
</html>
