<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard – ProblemSolver</title>
  <style>
    :root { --brand:#FF6B00; }
    body{ font-family: Inter, Arial, sans-serif; margin:0; background:#f5f5f7; color:#111; }
    .wrap{ max-width:980px; margin:32px auto; padding:0 16px; }
    .card{ background:#fff; border:1px solid #eee; border-radius:18px; box-shadow:0 6px 24px rgba(0,0,0,.06); }
    .head{ display:flex; align-items:center; justify-content:space-between; padding:22px 22px 0; }
    h1{ margin:0; font-size:28px; }
    .content{ padding:20px 22px 24px; }
    .grid{ display:grid; gap:16px; grid-template-columns: repeat(2,minmax(0,1fr)); }
    .box{ border:1px solid #eee; border-radius:12px; padding:14px 16px; background:#fafafa; }
    .muted{ color:#666; font-size:13px; }
    button{ border:0; border-radius:10px; padding:10px 14px; cursor:pointer; }
    .btn{ background:var(--brand); color:#fff; font-weight:600; }
    .row{ display:flex; gap:10px; align-items:center; }
    .right{ display:flex; gap:10px; }
    .ok{ background:#ecfff2; border:1px solid #baf0c8; color:#145a2a; padding:10px 12px; border-radius:10px; }
    .err{ background:#fff1f1; border:1px solid #f0bcbc; color:#7d1a1a; padding:10px 12px; border-radius:10px; }
    a.link{ color:#0b57d0; text-decoration:none; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body
  data-supabase-url="https://sctqieecpfsaszcuqcrv.supabase.co"
  data-supabase-key="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjdHFpZWVjcGZzYXN6Y3VxY3J2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkxODI5MjYsImV4cCI6MjA3NDc1ODkyNn0.swR5_WutqIlCvpH4s-2LEYgrH-UAp0op2sfKQeVWQOk"
>
<div class="wrap">
  <div class="card">
    <div class="head">
      <h1>Dashboard</h1>
      <div class="right">
        <button id="logoutBtn">Αποσύνδεση</button>
      </div>
    </div>
    <div class="content">
      <div id="status" class="ok" style="display:none;"></div>
      <div id="error" class="err" style="display:none;"></div>

      <div class="grid" style="margin-top:8px;">
        <div class="box">
          <div class="muted">Email</div>
          <div id="u_email">—</div>
        </div>
        <div class="box">
          <div class="muted">User ID</div>
          <div id="u_id" style="font-family:monospace; word-break:break-all;">—</div>
        </div>
        <div class="box">
          <div class="muted">Δημιουργήθηκε</div>
          <div id="u_created">—</div>
        </div>
        <div class="box">
          <div class="muted">Τελευταία σύνδεση</div>
          <div id="u_last">—</div>
        </div>
      </div>

      <div style="margin-top:18px;" class="muted">
        Αν θέλεις, μπορείς να <a class="link" href="/">επιστρέψεις στην είσοδο</a>.
      </div>
    </div>
  </div>
</div>

<script>
  const supabase = window.supabase.createClient(
    document.body.dataset.supabaseUrl,
    document.body.dataset.supabaseKey,
    { auth: { persistSession:true, autoRefreshToken:true, detectSessionInUrl:true } }
  );

  const $ = (id)=>document.getElementById(id);
  const show = (el,txt)=>{ el.textContent=txt; el.style.display='block'; };
  const hide = (el)=>{ el.style.display='none'; };

  async function loadUser() {
    const { data, error } = await supabase.auth.getUser();

    if (error || !data?.user) {
      // Δεν υπάρχει session -> γύρνα στην είσοδο
      location.replace(location.origin + '/');
      return;
    }

    const u = data.user;
    $('u_email').textContent = u.email ?? '—';
    $('u_id').textContent = u.id ?? '—';
    $('u_created').textContent = u.created_at ? new Date(u.created_at).toLocaleString() : '—';
    $('u_last').textContent = u.last_sign_in_at ? new Date(u.last_sign_in_at).toLocaleString() : '—';

    show($('status'), `Καλώς ήρθες, ${u.email}!`);
  }

  $('logoutBtn').onclick = async () => {
    await supabase.auth.signOut();
    location.replace(location.origin + '/');
  };

  // Αν για  οποιονδήποτε λόγο χαθεί το session, γύρνα πίσω
  supabase.auth.onAuthStateChange((event, session) => {
    if (!session) location.replace(location.origin + '/');
  });

  loadUser();
</script>
</body>
</html>
